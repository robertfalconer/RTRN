<!DOCTYPE html>
    <head>
        <script type="text/javascript" src="/_ah/channel/jsapi"></script>
    </head>
    <body>
    <h1>Results</h1>
    <a href="/test-channel?cid={{.channelId}}" target="_blank">Trigger new image</a>
    <div id="images"></div>
    <script>
        channel = new goog.appengine.Channel('{{.token}}');
        socket = channel.open();
        socket.onopen = function(){ console.log("channel open", arguments); };
        socket.onmessage = function(reponse)
        {
            var responseObject = JSON.parse(reponse.data);
            var image = document.createElement("img");
            var time = new Date().getTime();
            image.src = responseObject.URL + "?t=" + time;
            var images = document.getElementById("images");
            images.appendChild(image);
            setTimeout( function(){
                images.removeChild( image );
            }, 10 * 1000 )
        };
        socket.onerror = function(){ console.log('channel error', arguments); };
        socket.onclose = function(){ console.log('channel closed', arguments); };
    </script>
    </body>
</html>